'use strict';

function _toArray(arr) { return Array.isArray(arr) ? arr : Array.from(arr); }

var app = angular.module('NS-SSH', ['cfp.hotkeys']);

app.config(function ($locationProvider) {
	// Turn off # urls
	$locationProvider.html5Mode(true);
});
app.factory('clientCmdsFactory', function (themeFactory, musicFactory, shellDetails) {

	function changePrompt(args) {
		shellDetails.prompt = args.join(' ');
	}

	// Useful if the client is in a different time zone then the server
	function clientDate() {
		return new Date().toString();
	}

	// Switch back to Doogie Howser theme
	function doogie() {
		themeFactory.updateTheme(themeFactory.DOOGIE_THEME);
		musicFactory.updateAudio();
	}

	// cmd: teach   args: ['me', 'how', 'to', 'dougie']
	function teachDougie(args) {
		if (args.join(' ') !== 'me how to dougie') return;
		themeFactory.updateTheme(themeFactory.DOUGIE_THEME);
		musicFactory.updateAudio();
	}

	return {
		changePrompt: changePrompt,
		clientDate: clientDate,
		doogie: doogie,
		teach: teachDougie
	};
});

app.factory('musicFactory', function (themeFactory) {

	var audio = document.createElement('audio');

	updateAudio();

	function play() {
		audio.play();
	}

	function pause() {
		audio.pause();
	}

	function togglePlayPause() {
		audio.paused ? audio.play() : audio.pause();
	}

	function updateAudio() {
		audio.src = themeFactory.selectedTheme().audio;
		audio.load();
		audio.loop = true;
		play();
	}

	return {
		play: play,
		pause: pause,
		togglePlayPause: togglePlayPause,
		updateAudio: updateAudio
	};
});
app.factory('cmdLogFactory', function () {

	var cmdLog = [];
	var logPointer = 0;

	function addCmdToLog(cmd) {
		cmdLog.push(cmd);
		logPointer = cmdLog.length - 1;
	}

	function scrollLogUpKey() {
		var selectedPtr = logPointer;

		logPointer = selectedPtr - 1 === -1 ? 0 : selectedPtr - 1;
		return cmdLog[selectedPtr];
	}

	function scrollLogDownKey() {
		var selectedPtr = logPointer;
		logPointer = selectedPtr + 1 === cmdLog.length ? cmdLog.length - 1 : selectedPtr + 1;
		return cmdLog[selectedPtr];
	}

	return {
		addCmdToLog: addCmdToLog,
		scrollLogUpKey: scrollLogUpKey,
		scrollLogDownKey: scrollLogDownKey
	};
});
app.factory('shellDetails', function () {

	var prompt = 'prompt >';

	return {
		prompt: prompt
	};
});
app.factory('shellFactory', function ($http, $log, shellDetails, cmdLogFactory, clientCmdsFactory) {

	var cmdRoute = 'api/shell-cmd/';
	var results = [];

	function buildApiReqStr(user_cmd, args) {
		// args will be undefined if none are provided
		var argsRequest = args.length ? '/' + JSON.stringify(args) : '';

		return '' + cmdRoute + user_cmd + argsRequest;
	}

	function parseCmd(cmd) {
		var _cmd$split = cmd.split(' '),
		    _cmd$split2 = _toArray(_cmd$split),
		    user_cmd = _cmd$split2[0],
		    args = _cmd$split2.slice(1);

		return {
			user_cmd: user_cmd,
			args: args
		};
	}

	function submitCmd(cmd) {
		// If user just pressed enter or provided an empty string
		if (!cmd) {
			results.push(shellDetails.prompt);
			return;
		}
		var cmdObj = parseCmd(cmd);

		cmdLogFactory.addCmdToLog(cmd);
		console.log(clientCmdsFactory);
		// Check if it's a client side command√ü
		if (clientCmdsFactory[cmdObj.user_cmd]) {
			results.push(shellDetails.prompt + cmd);
			results.push(clientCmdsFactory[cmdObj.user_cmd](cmdObj.args));
		} else {
			$http.get(buildApiReqStr(cmdObj.user_cmd, cmdObj.args)).then(function (res) {
				results.push(shellDetails.prompt + cmd);
				results.push(res.data);
				window.scrollTo(0, document.body.scrollHeight); // Keep prompt at bottom of window
			}).catch($log);
		}
	}

	function fetchResults() {
		return results.slice();
	}

	function clearResults() {
		results = [];
	}

	function updatePrompt(newPrompt) {
		prompt = newPrompt;
	}

	return {
		submitCmd: submitCmd,
		fetchResults: fetchResults,
		clearResults: clearResults,
		updatePrompt: updatePrompt
	};
});
app.factory('themeFactory', function () {

	var DOOGIE_THEME = 'DOOGIE';
	var DOUGIE_THEME = 'DOUGIE';
	var currentTheme = DOOGIE_THEME;

	var themes = {
		DOOGIE: {
			audio: 'audio/DoogieHowserTheme.mp3',
			bannerText: 'PERSONAL TERMINAL OF DOOGIE HOWSER, M.D.'
		},
		DOUGIE: {
			audio: 'audio/TeachMeHowToDougie.mp3',
			bannerText: 'PERSONAL TERMINAL OF DO<s>O</s><ins>U</ins>GIE <s>HOWSER</s>, M.<s>D</s><ins>C</ins>'
		}
	};

	function selectedTheme() {
		return themes[currentTheme];
	}

	function updateTheme(theme) {
		if (~Object.keys(themes).indexOf(theme)) {
			currentTheme = theme;
		}
	}

	return {
		DOOGIE_THEME: DOOGIE_THEME,
		DOUGIE_THEME: DOUGIE_THEME,
		selectedTheme: selectedTheme,
		updateTheme: updateTheme
	};
});
app.directive('banner', function () {
	return {
		restrict: 'E',
		templateUrl: 'js/directives/banner/banner-template.html',
		controller: function controller($scope, $sce, themeFactory) {
			$scope.getThemeText = function () {
				return $sce.trustAsHtml(themeFactory.selectedTheme().bannerText);
			};
		}
	};
});
app.directive('shell', function () {
	return {
		restrict: 'E',
		templateUrl: 'js/directives/shell/shell-template.html',
		controller: function controller(musicFactory, hotkeys, shellFactory) {
			// musicFactory.play(); 

			hotkeys.add({
				combo: 'command+k',
				description: 'Clear window of previous results.',
				allowIn: ['INPUT'],
				callback: function callback() {
					shellFactory.clearResults();
				}
			});
			hotkeys.add({
				combo: 'command+p',
				description: 'Toggle music between play and pause. You\'re welcome...',
				allowIn: ['INPUT'],
				callback: function callback(event) {
					musicFactory.togglePlayPause();
					event.preventDefault();
				}
			});
		}
	};
});
app.directive('shellIntro', function () {
	return {
		restrict: 'E',
		templateUrl: 'js/directives/shell-intro/shell-intro-template.html',
		controller: function controller($scope) {
			var date = new Date();
			var dateString = date.toString();
			dateString = dateString.slice(0, dateString.indexOf(date.getFullYear()) + 4);
			$scope.date = '' + dateString;

			// document.addEventListener("DOMContentLoaded", function(){
			// 	console.log('got here')
			// 	Typed.new(".intro", {
			// 		strings: ["First sentence.", "Second sentence."],
			// 		typeSpeed: 0
			// 	});
			// });
		}
	};
});
app.directive('shellInputLine', function () {
	return {
		restrict: 'E',
		templateUrl: 'js/directives/shell-input-line/shell-input-line-template.html',
		controller: function controller($scope, hotkeys, shellDetails, shellFactory, cmdLogFactory) {
			$scope.submitCmd = function () {
				shellFactory.submitCmd($scope.shellCmd);
				$scope.shellCmd = '';
			};

			$scope.shellPrompt = function () {
				return shellDetails.prompt;
			};

			hotkeys.add({
				combo: 'up',
				description: 'Scroll up through previous commands.',
				allowIn: ['INPUT'],
				callback: function callback() {
					$scope.shellCmd = cmdLogFactory.scrollLogUpKey();
				}
			});
			hotkeys.add({
				combo: 'down',
				description: 'Scroll down through previuos commands.',
				allowIn: ['INPUT'],
				callback: function callback() {
					$scope.shellCmd = cmdLogFactory.scrollLogDownKey();
				}
			});
		}
	};
});
app.directive('shellResults', function () {
	return {
		restrict: 'E',
		templateUrl: 'js/directives/shell-results/results-template.html',
		controller: function controller($scope, shellFactory) {
			$scope.fetchResults = function () {
				return shellFactory.fetchResults();
			};
		}
	};
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImZhY3Rvcmllcy9jbGllbnQtY21kcy1mYWN0b3J5LmpzIiwiZmFjdG9yaWVzL211c2ljLWZhY3RvcnkuanMiLCJmYWN0b3JpZXMvc2hlbGwtY21kTG9nLWZhY3RvcnkuanMiLCJmYWN0b3JpZXMvc2hlbGwtZGV0YWlscy1mYWN0b3J5LmpzIiwiZmFjdG9yaWVzL3NoZWxsLWZhY3RvcnkuanMiLCJmYWN0b3JpZXMvdGhlbWUtZmFjdG9yeS5qcyIsImRpcmVjdGl2ZXMvYmFubmVyL2Jhbm5lci5qcyIsImRpcmVjdGl2ZXMvc2hlbGwvc2hlbGwuanMiLCJkaXJlY3RpdmVzL3NoZWxsLWludHJvL3NoZWxsLWludHJvLmpzIiwiZGlyZWN0aXZlcy9zaGVsbC1pbnB1dC1saW5lL3NoZWxsLWlucHV0LWxpbmUuanMiLCJkaXJlY3RpdmVzL3NoZWxsLXJlc3VsdHMvcmVzdWx0cy5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCJodG1sNU1vZGUiLCJmYWN0b3J5IiwidGhlbWVGYWN0b3J5IiwibXVzaWNGYWN0b3J5Iiwic2hlbGxEZXRhaWxzIiwiY2hhbmdlUHJvbXB0IiwiYXJncyIsInByb21wdCIsImpvaW4iLCJjbGllbnREYXRlIiwiRGF0ZSIsInRvU3RyaW5nIiwiZG9vZ2llIiwidXBkYXRlVGhlbWUiLCJET09HSUVfVEhFTUUiLCJ1cGRhdGVBdWRpbyIsInRlYWNoRG91Z2llIiwiRE9VR0lFX1RIRU1FIiwidGVhY2giLCJhdWRpbyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInBsYXkiLCJwYXVzZSIsInRvZ2dsZVBsYXlQYXVzZSIsInBhdXNlZCIsInNyYyIsInNlbGVjdGVkVGhlbWUiLCJsb2FkIiwibG9vcCIsImNtZExvZyIsImxvZ1BvaW50ZXIiLCJhZGRDbWRUb0xvZyIsImNtZCIsInB1c2giLCJsZW5ndGgiLCJzY3JvbGxMb2dVcEtleSIsInNlbGVjdGVkUHRyIiwic2Nyb2xsTG9nRG93bktleSIsIiRodHRwIiwiJGxvZyIsImNtZExvZ0ZhY3RvcnkiLCJjbGllbnRDbWRzRmFjdG9yeSIsImNtZFJvdXRlIiwicmVzdWx0cyIsImJ1aWxkQXBpUmVxU3RyIiwidXNlcl9jbWQiLCJhcmdzUmVxdWVzdCIsIkpTT04iLCJzdHJpbmdpZnkiLCJwYXJzZUNtZCIsInNwbGl0Iiwic3VibWl0Q21kIiwiY21kT2JqIiwiY29uc29sZSIsImxvZyIsImdldCIsInRoZW4iLCJyZXMiLCJkYXRhIiwid2luZG93Iiwic2Nyb2xsVG8iLCJib2R5Iiwic2Nyb2xsSGVpZ2h0IiwiY2F0Y2giLCJmZXRjaFJlc3VsdHMiLCJzbGljZSIsImNsZWFyUmVzdWx0cyIsInVwZGF0ZVByb21wdCIsIm5ld1Byb21wdCIsImN1cnJlbnRUaGVtZSIsInRoZW1lcyIsIkRPT0dJRSIsImJhbm5lclRleHQiLCJET1VHSUUiLCJ0aGVtZSIsIk9iamVjdCIsImtleXMiLCJpbmRleE9mIiwiZGlyZWN0aXZlIiwicmVzdHJpY3QiLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCIkc2NvcGUiLCIkc2NlIiwiZ2V0VGhlbWVUZXh0IiwidHJ1c3RBc0h0bWwiLCJob3RrZXlzIiwic2hlbGxGYWN0b3J5IiwiYWRkIiwiY29tYm8iLCJkZXNjcmlwdGlvbiIsImFsbG93SW4iLCJjYWxsYmFjayIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJkYXRlIiwiZGF0ZVN0cmluZyIsImdldEZ1bGxZZWFyIiwic2hlbGxDbWQiLCJzaGVsbFByb21wdCJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7QUFFQSxJQUFBQSxNQUFBQyxRQUFBQyxNQUFBLENBQUEsUUFBQSxFQUFBLENBQUEsYUFBQSxDQUFBLENBQUE7O0FBRUFGLElBQUFHLE1BQUEsQ0FBQSxVQUFBQyxpQkFBQSxFQUFBO0FBQ0E7QUFDQUEsbUJBQUFDLFNBQUEsQ0FBQSxJQUFBO0FBQ0EsQ0FIQTtBQ0pBTCxJQUFBTSxPQUFBLENBQUEsbUJBQUEsRUFBQSxVQUFB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QUdBO0FBUEEsRUFBQTtBQVNBLENBVkEiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgYXBwID0gYW5ndWxhci5tb2R1bGUoJ05TLVNTSCcsIFsnY2ZwLmhvdGtleXMnXSk7XG5cbmFwcC5jb25maWcoZnVuY3Rpb24oJGxvY2F0aW9uUHJvdmlkZXIpe1xuXHQvLyBUdXJuIG9mZiAjIHVybHNcblx0JGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xufSk7IiwiYXBwLmZhY3RvcnkoJ2NsaWVudENtZHNGYWN0b3J5JywgKHRoZW1lRmFjdG9yeSwgbXVzaWNGYWN0b3J5LCBzaGVsbERldGFpbHMpID0+IHtcblxuXHRmdW5jdGlvbiBjaGFuZ2VQcm9tcHQoYXJncyl7XG5cdFx0c2hlbGxEZXRhaWxzLnByb21wdCA9IGFyZ3Muam9pbignICcpO1xuXHR9XG5cblx0Ly8gVXNlZnVsIGlmIHRoZSBjbGllbnQgaXMgaW4gYSBkaWZmZXJlbnQgdGltZSB6b25lIHRoZW4gdGhlIHNlcnZlclxuXHRmdW5jdGlvbiBjbGllbnREYXRlKCl7XG5cdFx0cmV0dXJuIG5ldyBEYXRlKCkudG9TdHJpbmcoKTtcblx0fVxuXG5cdC8vIFN3aXRjaCBiYWNrIHRvIERvb2dpZSBIb3dzZXIgdGhlbWVcblx0ZnVuY3Rpb24gZG9vZ2llKCl7XG5cdFx0dGhlbWVGYWN0b3J5LnVwZGF0ZVRoZW1lKHRoZW1lRmFjdG9yeS5ET09HSUVfVEhFTUUpO1xuXHRcdG11c2ljRmFjdG9yeS51cGRhdGVBdWRpbygpO1xuXHR9XG5cblx0Ly8gY21kOiB0ZWFjaCAgIGFyZ3M6IFsnbWUnLCAnaG93JywgJ3RvJywgJ2RvdWdpZSddXG5cdGZ1bmN0aW9uIHRlYWNoRG91Z2llKGFyZ3Mpe1xuXHRcdGlmKGFyZ3Muam9pbignICcpICE9PSAnbWUgaG93IHRvIGRvdWdpZScpIHJldHVybjtcblx0XHR0aGVtZUZhY3RvcnkudXBkYXRlVGhlbWUodGhlbWVGYWN0b3J5LkRPVUdJRV9USEVNRSk7XG5cdFx0bXVzaWNGYWN0b3J5LnVwZGF0ZUF1ZGlvKCk7XG5cdH1cblxuXHRcblx0cmV0dXJuIHtcblx0XHRjaGFuZ2VQcm9tcHQsXG5cdFx0Y2xpZW50RGF0ZSxcblx0XHRkb29naWUsXG5cdFx0dGVhY2g6IHRlYWNoRG91Z2llXG5cdH1cblxufSk7XG4iLCJhcHAuZmFjdG9yeSgnbXVzaWNGYWN0b3J5JywgKHRoZW1lRmFjdG9yeSkgPT4ge1xuXG5cdGNvbnN0IGF1ZGlvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYXVkaW8nKTtcblxuXHR1cGRhdGVBdWRpbygpO1xuXG5cdGZ1bmN0aW9uIHBsYXkoKXsgYXVkaW8ucGxheSgpOyB9XG5cblx0ZnVuY3Rpb24gcGF1c2UoKXsgYXVkaW8ucGF1c2UoKTsgfVxuXG5cdGZ1bmN0aW9uIHRvZ2dsZVBsYXlQYXVzZSgpeyBhdWRpby5wYXVzZWQgPyBhdWRpby5wbGF5KCkgOiBhdWRpby5wYXVzZSgpOyB9XG5cblx0ZnVuY3Rpb24gdXBkYXRlQXVkaW8oKXtcblx0XHRhdWRpby5zcmMgPSB0aGVtZUZhY3Rvcnkuc2VsZWN0ZWRUaGVtZSgpLmF1ZGlvO1xuXHRcdGF1ZGlvLmxvYWQoKTtcblx0XHRhdWRpby5sb29wID0gdHJ1ZTtcblx0XHRwbGF5KCk7XG5cdH1cblxuXHRyZXR1cm4ge1xuXHRcdHBsYXksXG5cdFx0cGF1c2UsXG5cdFx0dG9nZ2xlUGxheVBhdXNlLFxuXHRcdHVwZGF0ZUF1ZGlvXG5cdH1cblxufSk7IiwiYXBwLmZhY3RvcnkoJ2NtZExvZ0ZhY3RvcnknLCAoKSA9PiB7XG5cblx0bGV0IGNtZExvZyA9IFtdO1xuXHRsZXQgbG9nUG9pbnRlciA9IDA7XG5cblx0ZnVuY3Rpb24gYWRkQ21kVG9Mb2coY21kKXtcblx0XHRjbWRMb2cucHVzaChjbWQpO1xuXHRcdGxvZ1BvaW50ZXIgPSBjbWRMb2cubGVuZ3RoIC0gMTtcblx0fVxuXG5cdGZ1bmN0aW9uIHNjcm9sbExvZ1VwS2V5KCl7XG5cdFx0bGV0IHNlbGVjdGVkUHRyID0gbG9nUG9pbnRlcjtcblxuXHRcdGxvZ1BvaW50ZXIgPSAoIHNlbGVjdGVkUHRyIC0gMSApID09PSAtMSA/IDAgOiBzZWxlY3RlZFB0ciAtIDE7XG5cdFx0cmV0dXJuIGNtZExvZ1tzZWxlY3RlZFB0cl07XG5cdH1cblxuXHRmdW5jdGlvbiBzY3JvbGxMb2dEb3duS2V5KCl7XG5cdFx0bGV0IHNlbGVjdGVkUHRyID0gbG9nUG9pbnRlcjtcblx0XHRsb2dQb2ludGVyID0gKHNlbGVjdGVkUHRyICsgMSkgPT09IGNtZExvZy5sZW5ndGggPyBjbWRMb2cubGVuZ3RoIC0gMSA6IHNlbGVjdGVkUHRyICsgMTtcblx0XHRyZXR1cm4gY21kTG9nW3NlbGVjdGVkUHRyXTtcblx0fVxuXG5cblx0cmV0dXJuIHtcblx0XHRhZGRDbWRUb0xvZyxcblx0XHRzY3JvbGxMb2dVcEtleSxcblx0XHRzY3JvbGxMb2dEb3duS2V5XG5cdH1cblxufSk7IiwiYXBwLmZhY3RvcnkoJ3NoZWxsRGV0YWlscycsICgpID0+IHtcblxuXHRsZXQgcHJvbXB0ID0gJ3Byb21wdCA+JztcblxuXHRyZXR1cm4ge1xuXHRcdHByb21wdFxuXHR9XG59KTsiLCJhcHAuZmFjdG9yeSgnc2hlbGxGYWN0b3J5JywgKCRodHRwLCAkbG9nLCBzaGVsbERldGFpbHMsIGNtZExvZ0ZhY3RvcnksIGNsaWVudENtZHNGYWN0b3J5KSA9PiB7XG5cblx0Y29uc3QgY21kUm91dGUgPSAnYXBpL3NoZWxsLWNtZC8nO1xuXHRsZXQgcmVzdWx0cyA9IFtdO1xuXHRcblx0ZnVuY3Rpb24gYnVpbGRBcGlSZXFTdHIodXNlcl9jbWQsIGFyZ3Mpe1xuXHRcdC8vIGFyZ3Mgd2lsbCBiZSB1bmRlZmluZWQgaWYgbm9uZSBhcmUgcHJvdmlkZWRcblx0XHRsZXQgYXJnc1JlcXVlc3QgPSBhcmdzLmxlbmd0aCA/IGAvJHtKU09OLnN0cmluZ2lmeShhcmdzKX1gIDogJyc7IFxuXHRcblx0XHRyZXR1cm4gYCR7Y21kUm91dGV9JHt1c2VyX2NtZH0ke2FyZ3NSZXF1ZXN0fWA7XG5cdH1cblxuXHRmdW5jdGlvbiBwYXJzZUNtZChjbWQpe1xuXHRcdGxldCBbIHVzZXJfY21kLCAuLi5hcmdzIF0gPSBjbWQuc3BsaXQoJyAnKTtcblx0XHRyZXR1cm4ge1xuXHRcdFx0dXNlcl9jbWQsXG5cdFx0XHRhcmdzXG5cdFx0fVxuXHR9XG5cblx0ZnVuY3Rpb24gc3VibWl0Q21kKGNtZCl7XG5cdFx0Ly8gSWYgdXNlciBqdXN0IHByZXNzZWQgZW50ZXIgb3IgcHJvdmlkZWQgYW4gZW1wdHkgc3RyaW5nXG5cdFx0aWYoIWNtZCkge1xuXHRcdFx0cmVzdWx0cy5wdXNoKHNoZWxsRGV0YWlscy5wcm9tcHQpO1xuXHRcdFx0cmV0dXJuOyBcblx0XHR9XG5cdFx0bGV0IGNtZE9iaiA9IHBhcnNlQ21kKGNtZCk7XG5cblx0XHRjbWRMb2dGYWN0b3J5LmFkZENtZFRvTG9nKGNtZCk7XG5cdFx0Y29uc29sZS5sb2coY2xpZW50Q21kc0ZhY3RvcnkpXG5cdFx0Ly8gQ2hlY2sgaWYgaXQncyBhIGNsaWVudCBzaWRlIGNvbW1hbmTDn1xuXHRcdGlmKGNsaWVudENtZHNGYWN0b3J5W2NtZE9iai51c2VyX2NtZF0pe1xuXHRcdFx0cmVzdWx0cy5wdXNoKHNoZWxsRGV0YWlscy5wcm9tcHQgKyBjbWQpO1xuXHRcdFx0cmVzdWx0cy5wdXNoKGNsaWVudENtZHNGYWN0b3J5W2NtZE9iai51c2VyX2NtZF0oY21kT2JqLmFyZ3MpKTtcblx0XHR9XG5cdFx0ZWxzZXtcblx0XHRcdCRodHRwLmdldChidWlsZEFwaVJlcVN0cihjbWRPYmoudXNlcl9jbWQsIGNtZE9iai5hcmdzKSlcblx0XHRcdC50aGVuKChyZXMpID0+IHtcblx0XHRcdFx0cmVzdWx0cy5wdXNoKHNoZWxsRGV0YWlscy5wcm9tcHQgKyBjbWQpO1xuXHRcdFx0XHRyZXN1bHRzLnB1c2gocmVzLmRhdGEpO1xuXHRcdFx0XHR3aW5kb3cuc2Nyb2xsVG8oMCxkb2N1bWVudC5ib2R5LnNjcm9sbEhlaWdodCk7IC8vIEtlZXAgcHJvbXB0IGF0IGJvdHRvbSBvZiB3aW5kb3dcblx0XHRcdH0pXG5cdFx0XHQuY2F0Y2goJGxvZylcblx0XHR9XG5cdH1cblxuXHRmdW5jdGlvbiBmZXRjaFJlc3VsdHMoKXtcblx0XHRyZXR1cm4gcmVzdWx0cy5zbGljZSgpO1xuXHR9XG5cblx0ZnVuY3Rpb24gY2xlYXJSZXN1bHRzKCl7XG5cdFx0cmVzdWx0cyA9IFtdO1xuXHR9XG5cblx0ZnVuY3Rpb24gdXBkYXRlUHJvbXB0KG5ld1Byb21wdCl7XG5cdFx0cHJvbXB0ID0gbmV3UHJvbXB0O1xuXHR9XG5cblx0cmV0dXJuIHtcblx0XHRzdWJtaXRDbWQsXG5cdFx0ZmV0Y2hSZXN1bHRzLFxuXHRcdGNsZWFyUmVzdWx0cyxcblx0XHR1cGRhdGVQcm9tcHRcblx0fVxufSk7IiwiYXBwLmZhY3RvcnkoJ3RoZW1lRmFjdG9yeScsICgpID0+e1xuXHRcblx0Y29uc3QgRE9PR0lFX1RIRU1FID0gJ0RPT0dJRSc7XG5cdGNvbnN0IERPVUdJRV9USEVNRSA9ICdET1VHSUUnO1xuXHRsZXQgY3VycmVudFRoZW1lID0gRE9PR0lFX1RIRU1FO1xuXG5cdGNvbnN0IHRoZW1lcyA9IHtcblx0XHRET09HSUU6IHtcblx0XHRcdGF1ZGlvOiAnYXVkaW8vRG9vZ2llSG93c2VyVGhlbWUubXAzJyxcblx0XHRcdGJhbm5lclRleHQ6ICdQRVJTT05BTCBURVJNSU5BTCBPRiBET09HSUUgSE9XU0VSLCBNLkQuJyxcblx0XHR9LFxuXHRcdERPVUdJRToge1xuXHRcdFx0YXVkaW86ICdhdWRpby9UZWFjaE1lSG93VG9Eb3VnaWUubXAzJyxcblx0XHRcdGJhbm5lclRleHQ6ICdQRVJTT05BTCBURVJNSU5BTCBPRiBETzxzPk88L3M+PGlucz5VPC9pbnM+R0lFIDxzPkhPV1NFUjwvcz4sIE0uPHM+RDwvcz48aW5zPkM8L2lucz4nLFxuXHRcdH0sXG5cdH1cblxuXHRmdW5jdGlvbiBzZWxlY3RlZFRoZW1lKCl7XG5cdFx0cmV0dXJuIHRoZW1lc1tjdXJyZW50VGhlbWVdO1xuXHR9XG5cblx0ZnVuY3Rpb24gdXBkYXRlVGhlbWUodGhlbWUpe1xuXHRcdGlmKH4gT2JqZWN0LmtleXModGhlbWVzKS5pbmRleE9mKHRoZW1lKSl7XG5cdFx0XHRjdXJyZW50VGhlbWUgPSB0aGVtZTtcblx0XHR9XG5cdH1cblxuXHRyZXR1cm4ge1xuXHRcdERPT0dJRV9USEVNRSxcblx0XHRET1VHSUVfVEhFTUUsXG5cdFx0c2VsZWN0ZWRUaGVtZSxcblx0XHR1cGRhdGVUaGVtZVxuXHR9XG59KSIsImFwcC5kaXJlY3RpdmUoJ2Jhbm5lcicsICgpID0+e1xuXHRyZXR1cm4ge1xuXHRcdHJlc3RyaWN0OiAnRScsXG5cdFx0dGVtcGxhdGVVcmw6ICdqcy9kaXJlY3RpdmVzL2Jhbm5lci9iYW5uZXItdGVtcGxhdGUuaHRtbCcsXG5cdFx0Y29udHJvbGxlcjogKCRzY29wZSwgJHNjZSwgdGhlbWVGYWN0b3J5KSA9PiB7XG5cdFx0XHQkc2NvcGUuZ2V0VGhlbWVUZXh0ID0gKCkgPT4gJHNjZS50cnVzdEFzSHRtbCh0aGVtZUZhY3Rvcnkuc2VsZWN0ZWRUaGVtZSgpLmJhbm5lclRleHQpO1xuXHRcdH1cblx0fVxufSk7IiwiYXBwLmRpcmVjdGl2ZSgnc2hlbGwnLCAoKSA9PiB7XG5cdHJldHVybiB7XG5cdFx0cmVzdHJpY3Q6ICdFJyxcblx0XHR0ZW1wbGF0ZVVybDogJ2pzL2RpcmVjdGl2ZXMvc2hlbGwvc2hlbGwtdGVtcGxhdGUuaHRtbCcsXG5cdFx0Y29udHJvbGxlcjogKG11c2ljRmFjdG9yeSwgaG90a2V5cywgc2hlbGxGYWN0b3J5KSA9PiB7IFxuXHRcdFx0Ly8gbXVzaWNGYWN0b3J5LnBsYXkoKTsgXG5cblx0XHRcdGhvdGtleXNcblx0XHRcdC5hZGQoe1xuXHRcdFx0XHRjb21ibzogJ2NvbW1hbmQraycsXG5cdFx0XHRcdGRlc2NyaXB0aW9uOiAnQ2xlYXIgd2luZG93IG9mIHByZXZpb3VzIHJlc3VsdHMuJyxcblx0XHRcdFx0YWxsb3dJbjogWydJTlBVVCddLFxuXHRcdFx0XHRjYWxsYmFjazogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0c2hlbGxGYWN0b3J5LmNsZWFyUmVzdWx0cygpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KVxuXHRcdFx0aG90a2V5cy5hZGQoe1xuXHRcdFx0XHRjb21ibzogJ2NvbW1hbmQrcCcsXG5cdFx0XHRcdGRlc2NyaXB0aW9uOiAnVG9nZ2xlIG11c2ljIGJldHdlZW4gcGxheSBhbmQgcGF1c2UuIFlvdVxcJ3JlIHdlbGNvbWUuLi4nLFxuXHRcdFx0XHRhbGxvd0luOiBbJ0lOUFVUJ10sXG5cdFx0XHRcdGNhbGxiYWNrOiBmdW5jdGlvbihldmVudCkge1xuXHRcdFx0XHRcdG11c2ljRmFjdG9yeS50b2dnbGVQbGF5UGF1c2UoKTtcblx0XHRcdFx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KVxuXHRcdH1cblx0fVxufSk7IiwiYXBwLmRpcmVjdGl2ZSgnc2hlbGxJbnRybycsICgpID0+IHtcblx0cmV0dXJuIHtcblx0XHRyZXN0cmljdDogJ0UnLFxuXHRcdHRlbXBsYXRlVXJsOiAnanMvZGlyZWN0aXZlcy9zaGVsbC1pbnRyby9zaGVsbC1pbnRyby10ZW1wbGF0ZS5odG1sJyxcblx0XHRjb250cm9sbGVyOiAoJHNjb3BlKSA9PiB7XG5cdFx0XHRjb25zdCBkYXRlID0gbmV3IERhdGUoKTtcblx0XHRcdGxldCBkYXRlU3RyaW5nID0gZGF0ZS50b1N0cmluZygpO1xuXHRcdFx0ZGF0ZVN0cmluZyA9IGRhdGVTdHJpbmcuc2xpY2UoMCwgZGF0ZVN0cmluZy5pbmRleE9mKGRhdGUuZ2V0RnVsbFllYXIoKSkgKyA0KTtcblx0XHRcdCRzY29wZS5kYXRlID0gYCR7ZGF0ZVN0cmluZ31gO1xuXG5cdFx0XHQvLyBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBmdW5jdGlvbigpe1xuXHRcdFx0Ly8gXHRjb25zb2xlLmxvZygnZ290IGhlcmUnKVxuXHRcdFx0Ly8gXHRUeXBlZC5uZXcoXCIuaW50cm9cIiwge1xuXHRcdFx0Ly8gXHRcdHN0cmluZ3M6IFtcIkZpcnN0IHNlbnRlbmNlLlwiLCBcIlNlY29uZCBzZW50ZW5jZS5cIl0sXG5cdFx0XHQvLyBcdFx0dHlwZVNwZWVkOiAwXG5cdFx0XHQvLyBcdH0pO1xuXHRcdFx0Ly8gfSk7XG5cdFx0fVxuXHR9XG5cbn0pOyIsImFwcC5kaXJlY3RpdmUoJ3NoZWxsSW5wdXRMaW5lJywgKCkgPT4ge1xuXHRyZXR1cm4ge1xuXHRcdHJlc3RyaWN0OiAnRScsXG5cdFx0dGVtcGxhdGVVcmw6ICdqcy9kaXJlY3RpdmVzL3NoZWxsLWlucHV0LWxpbmUvc2hlbGwtaW5wdXQtbGluZS10ZW1wbGF0ZS5odG1sJyxcblx0XHRjb250cm9sbGVyOiAoJHNjb3BlLCBob3RrZXlzLCBzaGVsbERldGFpbHMsIHNoZWxsRmFjdG9yeSwgY21kTG9nRmFjdG9yeSkgPT4ge1xuXHRcdFx0JHNjb3BlLnN1Ym1pdENtZCA9ICgpID0+IHtcblx0XHRcdFx0c2hlbGxGYWN0b3J5LnN1Ym1pdENtZCgkc2NvcGUuc2hlbGxDbWQpO1xuXHRcdFx0XHQkc2NvcGUuc2hlbGxDbWQgPSAnJztcblx0XHRcdH1cblxuXHRcdFx0JHNjb3BlLnNoZWxsUHJvbXB0ID0gKCkgPT4gc2hlbGxEZXRhaWxzLnByb21wdDtcblxuXHRcdFx0aG90a2V5cy5hZGQoe1xuXHRcdFx0XHRjb21ibzogJ3VwJyxcblx0XHRcdFx0ZGVzY3JpcHRpb246ICdTY3JvbGwgdXAgdGhyb3VnaCBwcmV2aW91cyBjb21tYW5kcy4nLFxuXHRcdFx0XHRhbGxvd0luOiBbJ0lOUFVUJ10sXG5cdFx0XHRcdGNhbGxiYWNrOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHQkc2NvcGUuc2hlbGxDbWQgPSBjbWRMb2dGYWN0b3J5LnNjcm9sbExvZ1VwS2V5KCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pXG5cdFx0XHRob3RrZXlzLmFkZCh7XG5cdFx0XHRcdGNvbWJvOiAnZG93bicsXG5cdFx0XHRcdGRlc2NyaXB0aW9uOiAnU2Nyb2xsIGRvd24gdGhyb3VnaCBwcmV2aXVvcyBjb21tYW5kcy4nLFxuXHRcdFx0XHRhbGxvd0luOiBbJ0lOUFVUJ10sXG5cdFx0XHRcdGNhbGxiYWNrOiBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHQkc2NvcGUuc2hlbGxDbWQgPSBjbWRMb2dGYWN0b3J5LnNjcm9sbExvZ0Rvd25LZXkoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSlcblxuXHRcdH1cblx0fVxufSk7IiwiYXBwLmRpcmVjdGl2ZSgnc2hlbGxSZXN1bHRzJywgKCkgPT4ge1xuXHRyZXR1cm4ge1xuXHRcdHJlc3RyaWN0OiAnRScsXG5cdFx0dGVtcGxhdGVVcmw6ICdqcy9kaXJlY3RpdmVzL3NoZWxsLXJlc3VsdHMvcmVzdWx0cy10ZW1wbGF0ZS5odG1sJyxcblx0XHRjb250cm9sbGVyOiBmdW5jdGlvbigkc2NvcGUsIHNoZWxsRmFjdG9yeSl7XG5cdFx0XHQkc2NvcGUuZmV0Y2hSZXN1bHRzID0gKCkgPT4ge1xuXHRcdFx0XHRyZXR1cm4gc2hlbGxGYWN0b3J5LmZldGNoUmVzdWx0cygpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxufSkiXX0=
